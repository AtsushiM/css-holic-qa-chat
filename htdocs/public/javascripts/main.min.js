var cssholicqachat={};cssholicqachat.socket=io.connect(),cssholicqachat.addQuestion=function(t){cssholicqachat.collections.questions.add(new cssholicqachat.models.Question({defaults:t}))},cssholicqachat._dayConvertAry=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],cssholicqachat._formatNumDigit2=function(t){return t=1*t,10>t&&(t="0"+t),""+t},cssholicqachat.formatDate=function(t){var s=cssholicqachat._formatNumDigit2,e=[t.getFullYear(),s(t.getMonth()),s(t.getDate())],i=[s(t.getHours()),s(t.getMinutes()),s(t.getSeconds())];return e.join("/")+"("+cssholicqachat._dayConvertAry[t.getDay()]+")"+" "+i.join(":")},cssholicqachat.collections={questions:new C.Collection},cssholicqachat.models={Question:C.Model.extend({defaults:{name:"",q:"",time:0},validate:{name:C.validate.isString,q:C.validate.isString,time:C.validate.isNumber}})},cssholicqachat.views={sendBlock:new C.View({el:"#send",init:function(){this.username=this.el.find(".username input"),this.question=this.el.find(".question input"),this.lock()},events:{me:{submit:"submit"}},lock:function(){this.el.css({opacity:"0.5"}),this.isLock=!0},unlock:function(){this.el.css({opacity:"1"}),this.isLock=!1},submit:function(t){t.preventDefault();var s=this.username.val()||"No name",e=this.question.val();!this.isLock&&e&&(cssholicqachat.socket.emit("sendquestion",{name:s,q:e}),this.question.val(""),this.lock())}}),questions:new C.View({el:"#questions",template:C.$("#template-question").html(),collection:cssholicqachat.collections.questions,init:function(){var t=this;t.collection.on("change",t.render),cssholicqachat.socket.on("recivequestion",function(t){cssholicqachat.addQuestion(t),cssholicqachat.views.sendBlock.unlock()})},events:{},clear:function(){this.el.html("")},render:function(t){t=t.get(),t.time=cssholicqachat.formatDate(new Date(t.time));var s=C.util.template(this.template,t),e=C.dom.create("li");C.dom.html(e,s),this.el.insertBefore(e)}})},cssholicqachat.socket.on("initializequestion",function(t){var s=0,e=t.length;for(cssholicqachat.views.questions.clear();e>s;s++)cssholicqachat.addQuestion(t[s]);cssholicqachat.views.sendBlock.unlock()}),function(){var t,s,e=C.$("h1"),i=C.util.unescape(e.html());for(e.html("<span>"+i.split("").join("</span><span>")+"</span>"),t=e.find("span"),s=t.length;s--;)C.dom.addClass(t[s],"letter"+s)}();